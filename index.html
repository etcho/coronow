<!DOCTYPE html>
<html>
    <head>
        <title>Coronow</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://code.jquery.com/jquery-3.5.0.min.js" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.12/js/select2.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.12/css/select2.min.css" />
    </head>
    <style>
        .header {
            width: 100%;
            text-align: center;
            background: #96ceb4;
            line-height: 45px;
            font-size: 30px;
            font-weight: bold;
        }

        .header span {
            font-style: italic;
            color: #ff6f69;
        }

        .container {
            padding-top: 10px;
        }

        h1 {
            font-size: 20px;
            text-align: center;
            margin-top: 20px;
            background: #ffcc5c;
            margin-bottom: 0;
            padding: 4px 0px;
            border-radius: 10px 10px 0px 0px;
        }

        .main-counter {
            background: #ffeead;
            text-align: center;
            font-size: 22px;
            padding: 10px 0px 15px;
        }

        label[for=country]{
            display: block;
        }
    </style>
    <body>
        <div class="header">Coro<span>now</span></div>
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <label for="country">Country</label>
                    <select id="country"></select>
                </div>
            </div>
            <div class="row">
                <div class="col-6 col-md-3">
                    <h1>Confirmed</h1>
                    <div class="main-counter" id="counter_confirmed"></div>
                </div>
                <div class="col-6 col-md-3">
                    <h1>Deaths</h1>
                    <div class="main-counter" id="counter_deaths"></div>
                </div>
                <div class="col-6 col-md-3">
                    <h1>Recovered</h1>
                    <div class="main-counter" id="counter_recovered"></div>
                </div>
                <div class="col-6 col-md-3">
                    <h1>Fatality</h1>
                    <div class="main-counter" id="counter_fatality"></div>
                </div>
            </div>
        </div>
    </body>
    <script>
        function numberFormat(number) {
            return new Intl.NumberFormat().format(number);
        }

        function hash() {
            return window.location.hash.replace("#", "");
        }

        function jump(h) {
            window.location.href = "#" + h;
        }

        var data = [];
        $(document).ready(function () {
            $.ajax({
                url: "https://pomber.github.io/covid19/timeseries.json",
                dataType: "json",
                success: function (d) {
                    data = d;
                    var world = [];
                    $("#country").append('<option value="world">World</option>');
                    $(Object.keys(data)).each(function (a, b) {
                        $("#country").append('<option value="' + b + '">' + b + '</option>');
                        $(data[b]).each(function (c, d) {
                            var found = false;
                            $(world).each(function (e, f) {
                                if (f.date === d.date) {
                                    world[e].confirmed += d.confirmed;
                                    world[e].deaths += d.deaths;
                                    world[e].recovered += d.recovered;
                                    found = true;
                                }
                            });
                            if (!found) {
                                world.push({date: d.date, confirmed: d.confirmed, deaths: d.deaths, recovered: d.recovered});
                            }
                        });
                    });
                    data.world = world;
                    if (hash().length > 0) {
                        $("#country option").each(function () {
                            if ($(this).attr("value").toLowerCase() === hash().toLowerCase()) {
                                $(this).prop("selected", true);
                            }
                        });
                    }
                    $("select").select2().trigger("change");
                }
            });

            $("#country").on("change", function () {
                var country = $(this).select2("val");
                var d = data[country];
                var last = d[d.length - 1];
                $("#counter_confirmed").html(numberFormat(last.confirmed));
                $("#counter_deaths").html(numberFormat(last.deaths));
                $("#counter_recovered").html(numberFormat(last.recovered));
                $("#counter_fatality").html(numberFormat((last.deaths / (last.confirmed) * 100).toFixed(1)) + "%");
                jump(country);
            });
        });
    </script>
</html>
